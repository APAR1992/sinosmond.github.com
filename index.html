
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sinosmond's Blog</title>
  <meta name="author" content="sinosmond">

  
  <meta name="description" content="说明 协作系统的开源软件很丰富，常用的有： DOkuwiki – 通常用于文档协作 eGroupware – 通常用于通用的项目协作 Redmine – 通常用于软件开发项目的协作 CentOS 6.2 的安装和基本配置 选择 Minimal 安装 CentOS 6.2 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sinosmond.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Sinosmond's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
#<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
#<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1567119-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
<style type="text/css">
<!--
	.head_flash
	{
		display:block;
		float:left;
		margin-left:10px;
		margin-right:10px;
	}
	.head_right
	{
		display:block;
		float:left;
		margin-right:30px;
	}
--> 
</style>
<div class="head_flash">
<a target="_blank" href="http://yuncoffee.com/"><img class="right" src="/images/coffee.gif" title="云咖啡50元券 手机二维码" ></a>
</div>
<!-- <div class="head_right">
<embed width="150" height="120" wmode="transparent" src="/images/Clock.swf">
</div>-->

<hgroup>
  <h1><a href="/">Sinosmond's Blog</a></h1>
  
    <h2>技术学习|生活记录|同道交流</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sinosmond.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/09/installing-the-collaboration-system/">在 CentOS 6.2 上安装协作系统</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-09T11:24:00+08:00" pubdate data-updated="true">Jul 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">说明</h2>

<p>协作系统的开源软件很丰富，常用的有：</p>

<ul>
  <li>DOkuwiki – 通常用于文档协作 </li>
  <li>eGroupware – 通常用于通用的项目协作</li>
  <li>Redmine – 通常用于软件开发项目的协作</li>
</ul>

<h2 id="centos-62-">CentOS 6.2 的安装和基本配置</h2>

<h3 id="minimal--centos-62">选择 Minimal 安装 CentOS 6.2</h3>

<p>配置使用官方仓库的国内镜像站点</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /etc/yum.repos.d/
</span><span class="line">mv CentOS-Base.repo<span class="o">{</span>,.orig<span class="o">}</span>
</span><span class="line">wget -O CentOS-Base.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-1">安装必要的工具和软件</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum -y install openssh-clients policycoreutils-python
</span><span class="line">yum -y install yum-plugin-<span class="o">{</span>security,priorities<span class="o">}</span> yum-utils
</span><span class="line">yum -y install system-config-<span class="o">{</span>firewall-tui,network-tui<span class="o">}</span> ntsysv
</span><span class="line">yum -y install wget lftp rsync elinks mutt tree vim-enhanced git
</span><span class="line">yum -y install jpackage-utils
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-2">配置主机名、网络参数、本地域名解析</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">system-config-network-tui
</span><span class="line">service network restart
</span><span class="line">vim /etc/hosts
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-3">配置第三方仓库</h3>

<p>1、安装 <em>release</em>.rpm 并导入仓库公钥</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> ;  mkdir RPM ;  <span class="nb">cd </span>RPM
</span><span class="line">wget http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-7.noarch.rpm
</span><span class="line">wget http://mirrors.sohu.com/dag/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
</span><span class="line">rpm -ivh epel-release-6-7.noarch.rpm
</span><span class="line">rpm -ivh rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
</span><span class="line">
</span><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-*
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、配置仓库优先级</p>

<ul>
  <li>[base]、[updates]、[extras]
    <ul>
      <li><code>priority=1</code></li>
    </ul>
  </li>
  <li>[centosplus]、[contrib]
    <ul>
      <li><code>priority=2</code></li>
    </ul>
  </li>
  <li>[epel]
    <ul>
      <li><code>priority=10</code></li>
    </ul>
  </li>
  <li>[rpmforge]
    <ul>
      <li><code>priority=15</code></li>
    </ul>
  </li>
</ul>

<p>3、配置使用非官方仓库的国内镜像站点</p>

<p>(1) EPEL</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /etc/yum.repos.d/
</span><span class="line">cp epel.repo<span class="o">{</span>,.orig<span class="o">}</span>
</span><span class="line">sed -i <span class="s2">&quot;s/^mirrorlist/#mirrorlist/g&quot;</span> epel.repo
</span><span class="line">sed -i <span class="s2">&quot;s/^#baseurl/baseurl/g&quot;</span> epel.repo
</span><span class="line">sed -i <span class="s2">&quot;s#download.fedoraproject.org/pub/epel#mirrors.sohu.com/fedora-epel#g&quot;</span> epel.repo
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>(2) RPMForge</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /etc/yum.repos.d/
</span><span class="line">cp rpmforge.repo<span class="o">{</span>,.orig<span class="o">}</span>
</span><span class="line">sed -i <span class="s2">&quot;s#baseurl = http://apt.sw.be#baseurl = http://mirrors.sohu.com/dag#g&quot;</span> rpmforge.repo
</span><span class="line">yum makecache
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="etckeeper-">安装 etckeeper 并更新系统</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum -y install etckeeper tig
</span><span class="line">etckeeper init
</span><span class="line">etckeeper commit <span class="s1">&#39;init&#39;</span>
</span><span class="line"><span class="nb">cd</span> /etc
</span><span class="line">tig
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum -y update
</span><span class="line">reboot
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="lamp-">安装 LAMP 环境</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">yum install mysql-server mysqltuner
</span><span class="line">yum install httpd php php-common php-gd php-mcrypt php-mbstring php-xml php-pear php-pecl-apc php-imap
</span><span class="line">yum install php-mysql php-pdo phpMyAdmin
</span><span class="line">
</span><span class="line">chkconfig --level 35 mysqld on
</span><span class="line">chkconfig --level 35 httpd on
</span><span class="line">
</span><span class="line">service mysqld start
</span><span class="line">service httpd start
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-4">配置防火墙</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">system-config-firewall-tui
</span><span class="line">
</span><span class="line"><span class="c">## 开启 80 端口。</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="apache--php--dokuwiki">Apache + PHP + Dokuwiki</h2>

<h3 id="dokuwiki-">下载最新的 DokuWIki 稳定版本</h3>

<p>EPEL 仓库提供了 Dokuwiki 的 RPM，可以直接使用 yum 安装，但其版本较旧。 下面下载最新的稳定版本。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /var/www/
</span><span class="line">wget http://www.splitbrain.org/_media/projects/dokuwiki/dokuwiki-2012-01-25a.tgz
</span><span class="line">tar xzf dokuwiki-2012-01-25a.tgz
</span><span class="line">mv dokuwiki-2012-01-25a dokuwiki
</span><span class="line">chown root.root dokuwiki
</span><span class="line">chown apache dokuwiki/conf
</span><span class="line">chown apache dokuwiki/data -R
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="dokuwiki--apache-">编写 Dokuwiki 的 Apache 配置文件</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /etc/httpd/conf.d/dokuwiki.conf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
</pre></td><td class="code"><pre><code class="apache"><span class="line"><span class="nb">Alias</span> <span class="sx">/wiki</span> <span class="sx">/var/www/dokuwiki</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;Directory</span> <span class="s">/var/www/dokuwiki</span><span class="nt">&gt;</span>
</span><span class="line">        <span class="nb">order</span> deny,allow
</span><span class="line">        <span class="nb">allow</span> from <span class="k">all</span>
</span><span class="line">
</span><span class="line"><span class="c">### 当在 Dokuwiki 配置界面的 “高级设置” 部分，将 &quot;使用更整洁的 URL&quot; 设置为 “.htaccess” </span>
</span><span class="line"><span class="c">### 或 在 /var/www/dokuwiki/conf/local.php 文件中配置了 $conf[&#39;userewrite&#39;] = &#39;1&#39;;</span>
</span><span class="line"><span class="c">### 之后，清除如下 Rewrite* 配置指令的注释符 </span>
</span><span class="line"><span class="c">#  RewriteEngine on</span>
</span><span class="line"><span class="c">#  RewriteBase /wiki</span>
</span><span class="line">
</span><span class="line"><span class="c">#  RewriteCond %{HTTPS} !=on</span>
</span><span class="line"><span class="c">#  RewriteRule ^lib/exe/xmlrpc.php$      https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301]</span>
</span><span class="line">
</span><span class="line"><span class="c">#  RewriteRule ^_media/(.*)              lib/exe/fetch.php?media=$1  [QSA,L]</span>
</span><span class="line"><span class="c">#  RewriteRule ^_detail/(.*)             lib/exe/detail.php?media=$1  [QSA,L]</span>
</span><span class="line"><span class="c">#  RewriteRule ^_export/([^/]+)/(.*)     doku.php?do=export_$1&amp;id=$2  [QSA,L]</span>
</span><span class="line"><span class="c">#  RewriteRule ^$                        doku.php  [L]</span>
</span><span class="line"><span class="c">#  RewriteCond %{REQUEST_FILENAME}       !-f</span>
</span><span class="line"><span class="c">#  RewriteCond %{REQUEST_FILENAME}       !-d</span>
</span><span class="line"><span class="c">#  RewriteRule (.*)                      doku.php?id=$1  [QSA,L]</span>
</span><span class="line"><span class="c">#  RewriteRule ^index.php$               doku.php</span>
</span><span class="line"><span class="nt">&lt;/Directory&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;LocationMatch</span> <span class="s">&quot;/wiki/(data|conf|bin|inc)/&quot;</span><span class="nt">&gt;</span>
</span><span class="line">        <span class="nb">order</span> allow,deny
</span><span class="line">        <span class="nb">deny</span> from <span class="k">all</span>
</span><span class="line">        <span class="nb">satisfy</span> <span class="k">all</span>
</span><span class="line"><span class="nt">&lt;/LocationMatch&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;Files</span> <span class="s">~ &quot;^([\._]ht|README$|VERSION$|COPYING$)&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nb">Order</span> allow,deny
</span><span class="line">    <span class="nb">Deny</span> from <span class="k">all</span>
</span><span class="line">    <span class="nb">Satisfy</span> <span class="k">All</span>
</span><span class="line"><span class="nt">&lt;/Files&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">service httpd restart
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="dokuwiki--1">安装常用的 Dokuwiki 插件</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /var/www/dokuwiki/lib/plugins
</span><span class="line"><span class="c">## 安装 sidebar 插件</span>
</span><span class="line">git clone git://github.com/chimeric/dokuwiki-plugin-sidebarng.git sidebarng
</span><span class="line"><span class="c">## 安装 snippets 插件（可使用此插件实现页面模板的功能）</span>
</span><span class="line">git clone git://github.com/cosmocode/dokuwiki-plugin-snippets.git snippets
</span><span class="line"><span class="c">## 安装 语法 插件</span>
</span><span class="line">git clone git://github.com/selfthinker/dokuwiki_plugin_wrap.git wrap
</span><span class="line">git clone git://github.com/dokufreaks/plugin-comment.git comment
</span><span class="line"><span class="c">## 安装 功能 插件</span>
</span><span class="line">git clone git://github.com/dokufreaks/plugin-pagelist.git pagelist
</span><span class="line">git clone git://github.com/dokufreaks/plugin-include.git include
</span><span class="line">git clone git://github.com/dokufreaks/plugin-tag.git tag
</span><span class="line">git clone git://github.com/dokufreaks/plugin-cloud.git cloud
</span><span class="line">git clone git://github.com/splitbrain/dokuwiki-plugin-s5.git s5
</span><span class="line">git clone git://github.com/dokufreaks/plugin-discussion.git discussion
</span><span class="line">git clone git://github.com/cosmocode/pagenav.git pagenav
</span><span class="line">git clone git://github.com/chimeric/dokuwiki-plugin-wikicalendar.git wikicalendar
</span><span class="line"><span class="c">#git clone git://github.com/gturri/nspages.git nspages</span>
</span><span class="line"><span class="c">#git clone git://github.com/splitbrain/dokuwiki-plugin-translation.git translation</span>
</span><span class="line"><span class="c">## 安装 维护 插件</span>
</span><span class="line">git clone git://github.com/Imhodad/dokuwiki-plugin-searchstats.git searchstats
</span><span class="line">git clone git://github.com/cosmocode/clearhistory.git clearhistory
</span><span class="line">git clone git://github.com/Taggic/orphanmedia.git orphanmedia
</span><span class="line">git clone git://github.com/Taggic/langdelete.git langdelete
</span><span class="line">git clone git://github.com/MrBertie/pagequery.git pagequery
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="dokuwiki">安装和配置 Dokuwiki</h3>

<ul>
  <li>您可以使用 Web 界面安装 Dokuwiki，使用浏览器打开 http://IPorFQDN/wiki/install.php 安装 Dokuwiki。</li>
  <li>您也可以直接编辑配置文件 /var/www/dokuwiki/conf/local.php 实现 DokuWiki 的配置。如下是一个配置文件例子：</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class="php"><span class="line"><span class="cp">&lt;?php</span>
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm"> * Dokuwiki&#39;s Main Configuration File - Local Settings</span>
</span><span class="line"><span class="cm"> * Auto-generated by config plugin</span>
</span><span class="line"><span class="cm"> * Run for user: osmond</span>
</span><span class="line"><span class="cm"> * Date: Thu, 05 Jul 2012 17:47:40 +0800</span>
</span><span class="line"><span class="cm"> */</span>
</span><span class="line">
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MyWiki&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;zh&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;license&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;youarehere&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;typography&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;useheading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;useacl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;superuser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;@admin&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;disableactions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;register&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;userewrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;useslash&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;hidepages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;snippets|sidebar&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;wikicalendar&#39;</span><span class="p">][</span><span class="s1">&#39;timezone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Asia/Shanghai&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;pagelist&#39;</span><span class="p">][</span><span class="s1">&#39;showdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;pagelist&#39;</span><span class="p">][</span><span class="s1">&#39;showtags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;tag&#39;</span><span class="p">][</span><span class="s1">&#39;toolbar_icon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;s5&#39;</span><span class="p">][</span><span class="s1">&#39;template&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;flower&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;discussion&#39;</span><span class="p">][</span><span class="s1">&#39;automatic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;discussion&#39;</span><span class="p">][</span><span class="s1">&#39;allowguests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;discussion&#39;</span><span class="p">][</span><span class="s1">&#39;linkemail&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;discussion&#39;</span><span class="p">][</span><span class="s1">&#39;useavatar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;discussion&#39;</span><span class="p">][</span><span class="s1">&#39;newestfirst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;translation&#39;</span><span class="p">][</span><span class="s1">&#39;translations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">;</span>
</span><span class="line"><span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;plugin&#39;</span><span class="p">][</span><span class="s1">&#39;translation&#39;</span><span class="p">][</span><span class="s1">&#39;about&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="c1">// end auto-generated content</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="apache--php--mysql--egroupware">Apache + PHP + MySQL + eGroupware</h2>

<h3 id="egroupware">安装 eGroupware</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nb">cd</span> /etc/yum.repos.d/
</span><span class="line">wget http://download.opensuse.org/repositories/server:eGroupWare/CentOS_6/server:eGroupWare.repo
</span><span class="line">yum install eGroupware
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="egroupware-">安装 eGroupware 的注意事项</h3>

<p>1、RPM 安装后执行的脚本：/usr/share/egroupware/doc/rpm-build/post_install.php，若您之前已经设置过 MySQL 的 root 口令，
请适当编辑此文件，之后重新执行此脚本。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /usr/share/egroupware/doc/rpm-build/post_install.php
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="php"><span class="line"><span class="x">    &#39;db_root&#39;     =&gt; &#39;root&#39;,        // mysql root user/pw to create database</span>
</span><span class="line"><span class="x">    &#39;db_root_pw&#39;  =&gt; &#39;YourPassword&#39;,</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">php /usr/share/egroupware/doc/rpm-build/post_install.php
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、安装日志： ~/eGroupware-install.log</p>

<p>3、eGroupware 的 RPM 自动安装了 Apache 的配置文件 /etc/httpd/conf.d/egroupware.conf。
以便可以使用 http://IPorFQDN/egroupware 的 URL 访问。</p>

<h3 id="section-5">解决项目模块的甘特图中文乱码问题</h3>

<p>1、从 Windows 系统上传字体文件</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">mkdir /usr/share/fonts/truetype/
</span><span class="line"><span class="c">### 上传字体文件</span>
</span><span class="line">ls
</span><span class="line">simfang.ttf  simhei.ttf  simsun.ttc
</span><span class="line"><span class="c">### 创建链接文件</span>
</span><span class="line"><span class="nb">cd</span> /usr/share/egroupware/projectmanager/inc/ttf-bitstream-vera-1.10
</span><span class="line">ln /usr/share/fonts/truetype/simsun.ttc
</span><span class="line">ln /usr/share/fonts/truetype/simhei.ttf
</span><span class="line">ln /usr/share/fonts/truetype/simfang.ttf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、修改 jpgraph 的 jpgraph_ttf.inc.php</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /usr/share/jpgraph/src/jpgraph_ttf.inc.php
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="php"><span class="line"><span class="x">        /* Chinese fonts */</span>
</span><span class="line"><span class="x">        FF_SIMSUN  =&gt;  array(</span>
</span><span class="line"><span class="x">            FS_NORMAL =&gt;&#39;simsun.ttc&#39;,</span>
</span><span class="line"><span class="x">            FS_BOLD =&gt;&#39;simhei.ttf&#39;,</span>
</span><span class="line"><span class="x">            FS_ITALIC =&gt;&#39;simfang.ttf&#39;,</span>
</span><span class="line"><span class="x">            FS_BOLDITALIC =&gt;&#39;simhei.ttf&#39; ),</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3、 修改 egroupware 的项目模块的相应代码</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">vim /usr/share/egroupware/projectmanager/inc/class.projectmanager_ganttchart.inc.php
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="php"><span class="line"><span class="x">找到并注释掉如下两行</span>
</span><span class="line"><span class="x">// if ($this-&gt;gantt_char_encode) $text = preg_replace(&#39;/[^\x00-\x7F]/e&#39;, &#39;&quot;&amp;#&quot;.ord(&quot;$0&quot;).&quot;;&quot;&#39;,$text);</span>
</span><span class="line">
</span><span class="line"><span class="x">// $graph-&gt;scale-&gt;SetDateLocale(common::setlocale());</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/24/centos6-dot-2-plus-jdk6-plus-tomcat7-plus-nginx1-dot-2-plus-mysql5-dot-x/">CentOS6.2 + JDK6 + Tomcat7 + Nginx1.2 + MySQL5.X</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-24T22:36:00+08:00" pubdate data-updated="true">Jun 24<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">说明</h2>

<ul>
  <li><strong>本指南不涉及多机集群。</strong>
    <ul>
      <li>是一个单机 Web 应用解决方案</li>
      <li>也可用于 Java Web 应用软件的测试环境</li>
      <li>笔者将其用在基于 DRBD 存储的 KVM 虚拟机里</li>
    </ul>
  </li>
  <li><strong>本指南的尽量使用 YUM 仓库安装所需软件。</strong>
    <ul>
      <li>方便日后更新</li>
      <li>方便日后使用 Puppet 进行管理 </li>
    </ul>
  </li>
</ul>

<h2 id="centos-62">安装 CentOS 6.2</h2>

<h3 id="section-1">分区设置</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># df -hT</span>
</span><span class="line">文件系统    类型      容量  已用  可用 已用%% 挂载点
</span><span class="line">/dev/mapper/vg0-lv_root
</span><span class="line">              ext4     50G  3.2G   44G   7% /
</span><span class="line">tmpfs        tmpfs    3.9G     0  3.9G   0% /dev/shm
</span><span class="line">/dev/mapper/vg0-lv_backup
</span><span class="line">              ext4     42G  176M   40G   1% /backup
</span><span class="line">/dev/sda1     ext4    485M   51M  409M  12% /boot
</span><span class="line">/dev/mapper/vg0-lv_mysql
</span><span class="line">              ext4     98G  188M   93G   1% /var/lib/mysql
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>提示：在 vg0 卷组中应保留一定的剩余空间，以便使用 LVM 快照对 mysql 进行备份。</strong></p>

<h3 id="section-2">选择安装组件</h3>

<p>选择 Minimal 安装 CentOS 6.2。</p>

<h2 id="section-3">配置使用官方仓库的国内镜像站点</h2>

<h3 id="section-4">方法1：</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd /etc/yum.repos.d/</span>
</span><span class="line"><span class="c"># cp CentOS-Base.repo{,.orig}</span>
</span><span class="line"><span class="c"># sed -i &quot;s/mirror.centos.org/mirrors.163.com/g&quot; CentOS-Base.repo</span>
</span><span class="line"><span class="c"># sed -i &quot;s/^mirrorlist/#mirrorlist/g&quot; CentOS-Base.repo</span>
</span><span class="line"><span class="c"># sed -i &quot;s/^#baseurl/baseurl/g&quot; CentOS-Base.repo</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-5">方法2：</h3>

<p>参考 <a href="http://mirrors.163.com/.help/centos.html">163镜像的说明文档</a> 下载 REPO 文件。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd /etc/yum.repos.d/</span>
</span><span class="line"><span class="c"># mv CentOS-Base.repo{,.orig}</span>
</span><span class="line"><span class="c"># wget -O CentOS-Base.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-6">安装必要的工具和软件</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum -y install openssh-clients policycoreutils-python</span>
</span><span class="line"><span class="c"># yum -y install yum-plugin-{security,priorities} yum-utils</span>
</span><span class="line"><span class="c"># yum -y install system-config-{firewall-tui,network-tui} ntsysv</span>
</span><span class="line"><span class="c"># yum -y install wget lftp rsync elinks mutt tree vim-enhanced git</span>
</span><span class="line"><span class="c"># yum -y install jpackage-utils</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-7">配置主机名、网络参数、本地域名解析</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># system-config-network-tui</span>
</span><span class="line"><span class="c"># service network restart</span>
</span><span class="line"><span class="c"># vim /etc/hosts</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-8">配置第三方仓库</h2>

<h3 id="releaserpm">下载仓库的 <em>release</em>.rpm</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd</span>
</span><span class="line"><span class="c"># mkdir RPM</span>
</span><span class="line"><span class="c"># cd RPM</span>
</span><span class="line"><span class="c"># wget http://mirrors.sohu.com/fedora-epel/6/x86_64/epel-release-6-7.noarch.rpm</span>
</span><span class="line"><span class="c"># wget http://mirrors.sohu.com/dag/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</span>
</span><span class="line"><span class="c"># wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</span>
</span><span class="line"><span class="c"># wget http://mirrors.dotsrc.org/jpackage/6.0/generic/free/RPMS/jpackage-release-6-3.jpp6.noarch.rpm</span>
</span><span class="line"><span class="c"># wget http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="releaserpm-">安装 <em>release</em>.rpm 并导入仓库公钥</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># rpm -ivh epel-release-6-7.noarch.rpm</span>
</span><span class="line"><span class="c"># rpm -ivh rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</span>
</span><span class="line"><span class="c"># rpm -ivh remi-release-6.rpm</span>
</span><span class="line"><span class="c"># rpm -ivh jpackage-release-6-3.jpp6.noarch.rpm</span>
</span><span class="line"><span class="c"># rpm -ivh nginx-release-centos-6-0.el6.ngx.noarch.rpm</span>
</span><span class="line">
</span><span class="line"><span class="c"># rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-*</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-9">配置仓库优先级</h3>

<ul>
  <li>[base]、[updates]、[extras]、[remi]
    <ul>
      <li><code>priority=1</code></li>
    </ul>
  </li>
  <li>[centosplus]、[contrib]
    <ul>
      <li><code>priority=2</code></li>
    </ul>
  </li>
  <li>[epel]
    <ul>
      <li><code>priority=10</code></li>
    </ul>
  </li>
  <li>[rpmforge]
    <ul>
      <li><code>priority=15</code></li>
    </ul>
  </li>
</ul>

<h3 id="section-10">配置使用非官方仓库的国内镜像站点</h3>

<p>1、EPEL</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd /etc/yum.repos.d/</span>
</span><span class="line"><span class="c"># cp epel.repo{,.orig}</span>
</span><span class="line"><span class="c"># sed -i &quot;s/^mirrorlist/#mirrorlist/g&quot; epel.repo</span>
</span><span class="line"><span class="c"># sed -i &quot;s/^#baseurl/baseurl/g&quot; epel.repo</span>
</span><span class="line"><span class="c"># sed -i &quot;s#download.fedoraproject.org/pub/epel#mirrors.sohu.com/fedora-epel#g&quot; epel.repo</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、RPMForge</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd /etc/yum.repos.d/</span>
</span><span class="line"><span class="c"># cp rpmforge.repo{,.orig}</span>
</span><span class="line"><span class="c"># sed -i &quot;s#baseurl = http://apt.sw.be#baseurl = http://mirrors.sohu.com/dag#g&quot; rpmforge.repo</span>
</span><span class="line"><span class="c"># yum makecache</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="etckeeper-">安装 etckeeper 并更新系统</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum -y install etckeeper tig</span>
</span><span class="line"><span class="c"># etckeeper init</span>
</span><span class="line"><span class="c"># etckeeper commit &#39;init&#39;</span>
</span><span class="line"><span class="c"># cd /etc</span>
</span><span class="line"><span class="c"># tig</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum -y update</span>
</span><span class="line"><span class="c"># reboot</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="jdk6">安装配置 JDK6</h2>

<h3 id="jdk6-1">安装 JDK6</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd; mkdir jdk6; cd jdk6</span>
</span><span class="line"><span class="c">## 从 http://www.oracle.com/technetwork/java/javase/downloads/index.html 下载最新版</span>
</span><span class="line"><span class="c"># ll</span>
</span><span class="line">-rw-r--r--. 1 root root 68826379  5月 17 05:22 jdk-6u33-linux-x64-rpm.bin
</span><span class="line"><span class="c"># chmod +x jdk-6u33-linux-x64-rpm.bin</span>
</span><span class="line"><span class="c"># ./jdk-6u33-linux-x64-rpm.bin</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="jdk6-2">配置 JDK6</h3>

<p>1、使用 alternatives 配置当前使用的 Java</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># alternatives --install /usr/bin/java java /usr/java/jdk1.6.0_33/jre/bin/java 20000</span>
</span><span class="line"><span class="c"># alternatives --install /usr/bin/javac javac /usr/java/jdk1.6.0_33/bin/javac 20000</span>
</span><span class="line"><span class="c"># alternatives --install /usr/bin/jar jar /usr/java/jdk1.6.0_33/bin/jar 20000</span>
</span><span class="line">
</span><span class="line"><span class="c"># java -version</span>
</span><span class="line">java version <span class="s2">&quot;1.6.0_33&quot;</span>
</span><span class="line">Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.6.0_33-b03<span class="o">)</span>
</span><span class="line">Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 20.8-b03, mixed mode<span class="o">)</span>
</span><span class="line"><span class="c"># javac -version</span>
</span><span class="line">javac 1.6.0_33
</span><span class="line">
</span><span class="line"><span class="c">### 日后安装其他 JDK 后可以重新配置当前的 Java</span>
</span><span class="line"><span class="c"># alternatives --config java</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><a href="http://www.if-not-true-then-false.com/2010/install-sun-oracle-java-jdk-jre-6-on-fedora-centos-red-hat-rhel/">参考</a></p>

<p>2、配置环境变量</p>

<ul>
  <li>系统级别 —— /etc/profile</li>
  <li>用户级别 —— ~/.bashrc</li>
</ul>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cat &lt;&lt;_END_&gt;&gt; /etc/profile</span>
</span><span class="line">
</span><span class="line"><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/default
</span><span class="line"><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/bin:<span class="nv">$JAVA_HOME</span>/jre/bin:<span class="nv">$PATH</span>
</span><span class="line"><span class="nb">export </span><span class="nv">CLASSPATH</span><span class="o">=</span>.:<span class="nv">$JAVA_HOME</span>/lib:<span class="nv">$JAVA_HOME</span>/jre/lib:<span class="nv">$CLASSPATH</span>
</span><span class="line">_END_
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="tomcat7--ngnix12">安装配置 Tomcat7 和 Ngnix1.2</h2>

<h3 id="tomcat7--ngnix12-1">安装 Tomcat7 和 Ngnix1.2</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum -y install tomcat7 nginx</span>
</span><span class="line"><span class="c"># chkconfig --level 345 tomcat7 on </span>
</span><span class="line"><span class="c"># chkconfig --level 345 nginx on</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>参考: <a href="http://www.distrotips.com/centos/installing-tomcat-7-on-centos-6.html">不使用 yum 仓库，直接解包安装 Tomcat7</a>
TODO: <a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+RedHat+distributions">Installing Jenkins</a></p>

<h3 id="tomcat7">配置 Tomcat7</h3>

<p>1、配置 Tomcat7 所需的环境变量</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/tomcat7/tomcat7.conf</span>
</span><span class="line">
</span><span class="line"><span class="c">## 在如下行</span>
</span><span class="line"><span class="c">#JAVA_HOME=&quot;/usr/lib/jvm/java&quot;</span>
</span><span class="line"><span class="c">## 之后添加如下行</span>
</span><span class="line"><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s2">&quot;/usr/java/default&quot;</span>
</span><span class="line">
</span><span class="line"><span class="c">## 对于生产环境，根据机器性能适当调整 Java 使用的内存</span>
</span><span class="line"><span class="c">## 在如下行</span>
</span><span class="line"><span class="c">#JAVA_OPTS=&quot;-Xminf0.1 -Xmaxf0.3&quot;</span>
</span><span class="line"><span class="c">## 之后添加如下行</span>
</span><span class="line"><span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;-Xms2624m -Xmx2624m -Xss2024K -XX:PermSize=528m -XX:MaxPermSize=856m&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、安装默认 Web 应用案例及文档并测试</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum install tomcat7-webapps tomcat7-docs-webapp</span>
</span><span class="line"><span class="c"># service tomcat7 restart</span>
</span><span class="line"><span class="c"># elinks http://localhost:8080</span>
</span><span class="line"><span class="c"># elinks http://YourIP:8080</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3、编辑 server.xml 文件</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/tomcat7/server.xml</span>
</span><span class="line">
</span><span class="line"><span class="c">## 对生产环境优化连接</span>
</span><span class="line"><span class="c">## 找到如下的行</span>
</span><span class="line">    &lt;Connector <span class="nv">port</span><span class="o">=</span><span class="s2">&quot;8080&quot;</span> <span class="nv">protocol</span><span class="o">=</span><span class="s2">&quot;HTTP/1.1&quot;</span>
</span><span class="line">               <span class="nv">connectionTimeout</span><span class="o">=</span><span class="s2">&quot;20000&quot;</span>
</span><span class="line">               <span class="nv">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span> /&gt;
</span><span class="line"><span class="c">## 将其改为：</span>
</span><span class="line">    &lt;Connector <span class="nv">port</span><span class="o">=</span><span class="s2">&quot;8080&quot;</span> <span class="nv">protocol</span><span class="o">=</span><span class="s2">&quot;HTTP/1.1&quot;</span>
</span><span class="line">               <span class="nv">connectionTimeout</span><span class="o">=</span><span class="s2">&quot;20000&quot;</span>
</span><span class="line">               <span class="nv">redirectPort</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span>
</span><span class="line">               <span class="nv">maxHttpHeaderSize</span><span class="o">=</span><span class="s2">&quot;8192&quot;</span>
</span><span class="line">               <span class="nv">useBodyEncodingForURI</span><span class="o">=</span><span class="s2">&quot;true&quot;</span>
</span><span class="line">               <span class="nv">URIEncoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>
</span><span class="line">               <span class="nv">maxThreads</span><span class="o">=</span><span class="s2">&quot;2048&quot;</span> <span class="nv">minSpareThreads</span><span class="o">=</span><span class="s2">&quot;100&quot;</span>
</span><span class="line">               <span class="nv">acceptCount</span><span class="o">=</span><span class="s2">&quot;500&quot;</span>
</span><span class="line">               <span class="nv">enableLookups</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> /&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>4、部署自己的 Webapp 并测试</p>

<p>将自己的应用程序放置在 /var/lib/tomcat7/webapps 目录下替换原来的 ROOT 目录的内容；
或将自己的应用程序的 WAR 文件改名为 <code>ROOT.war</code> 放置在/var/lib/tomcat7/webapps 目录下，
然后编辑 /etc/tomcat7/Catalina/localhost/ROOT.xml，添加如下内容进行部署：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span class="nt">&lt;Context</span> <span class="na">path=</span><span class="s">&quot;&quot;</span> <span class="na">docBase=</span><span class="s">&quot;ROOT.war&quot;</span><span class="nt">&gt;&lt;/Context&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>因为需要 tomcat 部署 ROOT 目录，且 jpackage 的 Tomcat7 以 tomcat 用户运行，
所以需要适当调整 webapps 目录的权限：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># chown tomcat /var/lib/tomcat7/webapps</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>重新启动 tomcat 并进行浏览测试。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># service tomcat7 restart</span>
</span><span class="line"><span class="c"># elinks http://localhost:8080</span>
</span><span class="line"><span class="c"># elinks http://YourIP:8080</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="ngnix">配置 Ngnix</h3>

<p>1、配置 proxy 通用参数</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/nginx/conf.d/proxy.conf</span>
</span><span class="line">
</span><span class="line">proxy_redirect     off;
</span><span class="line">proxy_set_header   Host <span class="nv">$host</span>;
</span><span class="line">proxy_set_header   X-Real-IP <span class="nv">$remote_addr</span>;
</span><span class="line">proxy_set_header   X-Forwarded-For   <span class="nv">$proxy_add_x_forwarded_for</span>;
</span><span class="line">
</span><span class="line">proxy_connect_timeout     60;
</span><span class="line">proxy_read_timeout        60;
</span><span class="line">proxy_send_timeout        60;
</span><span class="line">proxy_buffer_size        32k;
</span><span class="line">proxy_buffers          4 64k;
</span><span class="line">proxy_busy_buffers_size 128k;
</span><span class="line">proxy_temp_file_write_size 128k;
</span><span class="line">proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、修改默认主机配置</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># cd /etc/nginx/conf.d/</span>
</span><span class="line"><span class="c"># cp default.conf{,.orig}</span>
</span><span class="line"><span class="c"># vim default.conf</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="nginx"><span class="line"><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span><span class="line">    <span class="kn">root</span>   <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span class="line">    <span class="kn">index</span>  <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span><span class="line">    <span class="c1">## 添加如下行</span>
</span><span class="line">    <span class="kn">proxy_pass</span>  <span class="s">http://127.0.0.1:8080</span><span class="p">;</span>
</span><span class="line"> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3、参数调整和优化</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/nginx/conf.d/optimization.conf</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="nginx"><span class="line"><span class="k">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
</span><span class="line"><span class="k">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">server_tokens</span> <span class="no">off</span><span class="p">;</span>
</span><span class="line"><span class="k">server_name_in_redirect</span> <span class="no">off</span><span class="p">;</span>
</span><span class="line"><span class="k">server_names_hash_bucket_size</span> <span class="mi">128</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">client_header_buffer_size</span> <span class="mi">32k</span><span class="p">;</span>
</span><span class="line"><span class="k">client_body_buffer_size</span> <span class="mi">128k</span><span class="p">;</span>
</span><span class="line"><span class="k">client_max_body_size</span> <span class="mi">30m</span><span class="p">;</span>
</span><span class="line"><span class="k">large_client_header_buffers</span> <span class="mi">4</span> <span class="mi">32k</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">gzip</span> <span class="no">on</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_min_length</span> <span class="mi">1k</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_buffers</span> <span class="mi">4</span> <span class="mi">16k</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_comp_level</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_vary</span> <span class="no">on</span><span class="p">;</span>
</span><span class="line"><span class="k">gzip_types</span> <span class="s">text/plain</span> <span class="s">application/x-javascript</span> <span class="s">text/css</span> <span class="s">application/xml</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>4、重启 Nginx，访问由其代理的 Tomcat 站点</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># service nginx restart</span>
</span><span class="line"><span class="c">### 使用浏览器测试 http://YourIP 或 http://YourFQDN</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="mysql-">安装 MySQL 服务</h2>

<p>1、使用 yum 安装 mysql-server</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">## 选择1. 安装 remi 仓库提供的 MySQL 5.5 （建议）</span>
</span><span class="line"><span class="c"># yum --enablerepo=remi install mysql-server mysqltuner</span>
</span><span class="line"><span class="c">## 选择2. 安装官方仓库提供的 MySQL 5.1 </span>
</span><span class="line"><span class="c"># yum install mysql-server mysqltuner</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、安装后的基本配置</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># chkconfig --level 35 mysqld on</span>
</span><span class="line"><span class="c"># service mysqld start</span>
</span><span class="line"><span class="c">## 为 MySQL 的 root 用户设置口令  </span>
</span><span class="line"><span class="c"># mysqladmin -u root password &#39;my0wnSecrectpAs5&#39;</span>
</span><span class="line"><span class="c">## 或运行 MySQL 的安全安装脚本 </span>
</span><span class="line"><span class="c"># mysql_secure_installation</span>
</span><span class="line"><span class="c">## 查看服务的参数配置及性能</span>
</span><span class="line"><span class="c"># mysqltuner</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="mysql--1">配置 MySQL 服务</h2>

<p>参考 /usr/share/mysql/ 目录下提供的配置文件模板：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">ll /usr/share/mysql/my-*.cnf
</span><span class="line">-rw-r--r--. 1 root root  4697  6月  1 23:39 /usr/share/mysql/my-huge.cnf
</span><span class="line">-rw-r--r--. 1 root root 19779  6月  1 23:39 /usr/share/mysql/my-innodb-heavy-4G.cnf
</span><span class="line">-rw-r--r--. 1 root root  4671  6月  1 23:39 /usr/share/mysql/my-large.cnf
</span><span class="line">-rw-r--r--. 1 root root  4682  6月  1 23:39 /usr/share/mysql/my-medium.cnf
</span><span class="line">-rw-r--r--. 1 root root  2846  6月  1 23:39 /usr/share/mysql/my-small.cnf
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>选择合适的模板将其复制到 /etc/my.cnf ，并作适当修改。例如：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># mv /etc/my.cnf{,.orig}</span>
</span><span class="line"><span class="c"># cp /usr/share/mysql/my-large.cnf /etc/my.cnf</span>
</span><span class="line"><span class="c"># vi /etc/my.cnf</span>
</span><span class="line"><span class="c"># service mysqld restart</span>
</span><span class="line"><span class="c"># mysqltuner</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="phpmyadmin">安装配置 phpMyAdmin</h2>

<p>参考: <a href="http://www.if-not-true-then-false.com/2012/install-phpmyadmin-on-fedora-centos-red-hat-rhel/">install-phpmyadmin-on-fedora-centos-red-hat-rhel</a></p>

<h3 id="phpmyadmin-1">安装 phpMyAdmin</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum --enablerepo=remi install php php-fpm php-common php-gd php-mcrypt php-mbstring php-xml php-pecl-apc phpMyAdmin</span>
</span><span class="line"><span class="c"># chkconfig --level 35  php-fpm on</span>
</span><span class="line"><span class="c"># service php-fpm start </span>
</span><span class="line"><span class="c"># chkconfig --level 35  httpd off</span>
</span><span class="line"><span class="c"># service httpd stop</span>
</span><span class="line"><span class="c"># service nginx start</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="nginx--php-fpm">配置 Nginx 和 PHP-FPM</h3>

<p>为 phpMyAdmin 配置虚拟主机。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/nginx/conf.d/phpMyAdmin.conf</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
</pre></td><td class="code"><pre><code class="nginx"><span class="line"><span class="k">server</span> <span class="p">{</span>
</span><span class="line">       <span class="kn">listen</span>   <span class="mi">80</span><span class="p">;</span>
</span><span class="line">       <span class="kn">server_name</span> <span class="s">pma.domain.com</span><span class="p">;</span>
</span><span class="line">       <span class="kn">access_log</span> <span class="s">/var/log/nginx/phpmyadmin/access.log</span><span class="p">;</span>
</span><span class="line">       <span class="kn">error_log</span> <span class="s">/var/log/nginx/phpmyadmin/error.log</span><span class="p">;</span>
</span><span class="line">       <span class="kn">root</span> <span class="s">/usr/share/phpMyAdmin</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">       <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span><span class="line">           <span class="kn">index</span>  <span class="s">index.php</span><span class="p">;</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">
</span><span class="line">       <span class="c1">## Images and static content is treated different</span>
</span><span class="line">       <span class="kn">location</span> <span class="p">~</span><span class="sr">*</span> <span class="s">^.+.(jpg|jpeg|gif|css|png|js|ico|xml)</span>$ <span class="p">{</span>
</span><span class="line">           <span class="kn">access_log</span>        <span class="no">off</span><span class="p">;</span>
</span><span class="line">           <span class="kn">expires</span>           <span class="s">360d</span><span class="p">;</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">
</span><span class="line">       <span class="kn">location</span> <span class="p">~</span> <span class="sr">/\.ht</span> <span class="p">{</span>
</span><span class="line">           <span class="kn">deny</span>  <span class="s">all</span><span class="p">;</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">
</span><span class="line">       <span class="kn">location</span> <span class="p">~</span> <span class="sr">/(libraries|setup/frames|setup/libs)</span> <span class="p">{</span>
</span><span class="line">           <span class="kn">deny</span> <span class="s">all</span><span class="p">;</span>
</span><span class="line">           <span class="kn">return</span> <span class="mi">404</span><span class="p">;</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line">
</span><span class="line">       <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
</span><span class="line">           <span class="kn">include</span> <span class="s">/etc/nginx/fastcgi_params</span><span class="p">;</span>
</span><span class="line">           <span class="kn">fastcgi_pass</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">9000</span><span class="p">;</span>
</span><span class="line">           <span class="kn">fastcgi_index</span> <span class="s">index.php</span><span class="p">;</span>
</span><span class="line">           <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="s">/usr/share/phpMyAdmin</span><span class="nv">$fastcgi_script_name</span><span class="p">;</span>
</span><span class="line">       <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">### 检查配置文件语法的正确性</span>
</span><span class="line"><span class="c"># nginx -t</span>
</span><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span><span class="line">nginx: <span class="o">[</span>emerg<span class="o">]</span> open<span class="o">()</span> <span class="s2">&quot;/var/log/nginx/phpmyadmin/access.log&quot;</span> failed <span class="o">(</span>2: No such file or directory<span class="o">)</span>
</span><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>failed
</span><span class="line"><span class="c">### 为分离的日志创建存放目录</span>
</span><span class="line"><span class="c"># mkdir /var/log/nginx/phpmyadmin/ </span>
</span><span class="line"><span class="c">### 重新检查配置文件语法的正确性</span>
</span><span class="line"><span class="c"># nginx -t</span>
</span><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>is successful
</span><span class="line"><span class="c">### 重启 Nginx</span>
</span><span class="line"><span class="c"># service nginx restart</span>
</span><span class="line"><span class="c">### 配置 pma.domain.com 的域名解析后</span>
</span><span class="line"><span class="c">### 使用浏览器访问 http://pma.domain.com 测试</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-11">配置防火墙</h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">#  system-config-firewall-tui</span>
</span><span class="line">
</span><span class="line"><span class="c">## 开启 80 端口。</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>或编辑 /etc/sysconfig/iptables 开启 80 端口。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/sysconfig/iptables</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># Firewall configuration written by system-config-firewall</span>
</span><span class="line"><span class="c"># Manual customization of this file is not recommended.</span>
</span><span class="line">*filter
</span><span class="line">:INPUT ACCEPT <span class="o">[</span>0:0<span class="o">]</span>
</span><span class="line">:FORWARD ACCEPT <span class="o">[</span>0:0<span class="o">]</span>
</span><span class="line">:OUTPUT ACCEPT <span class="o">[</span>0:0<span class="o">]</span>
</span><span class="line">-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
</span><span class="line">-A INPUT -p icmp -j ACCEPT
</span><span class="line">-A INPUT -i lo -j ACCEPT
</span><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
</span><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
</span><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited
</span><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited
</span><span class="line">COMMIT
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vim /etc/sysconfig/iptables</span>
</span><span class="line">
</span><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>重新启动防火墙</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># chkconfig iptables on</span>
</span><span class="line"><span class="c"># service iptables restart</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="section-12">备份</h2>

<h3 id="mylvmbackup--mysql-">使用 mylvmbackup 备份 MySQL 数据库</h3>

<p>1、安装 mylvmbackup</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># yum install perl-Config-IniFiles perl-TimeDate</span>
</span><span class="line"><span class="c"># wget http://www.lenzg.net/mylvmbackup/mylvmbackup-0.13-0.noarch.rpm</span>
</span><span class="line"><span class="c"># rpm -ivh mylvmbackup-0.13-0.noarch.rpm</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、配置 mylvmbackup</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># vi /etc/mylvmbackup.conf</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>修改如下配置：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="o">[</span>mysql<span class="o">]</span>
</span><span class="line"><span class="nv">user</span><span class="o">=</span>root
</span><span class="line"><span class="nv">password</span><span class="o">=</span>my0wnSecrectpAs5
</span><span class="line"><span class="nv">host</span><span class="o">=</span>localhost
</span><span class="line"><span class="nv">port</span><span class="o">=</span>3306
</span><span class="line"><span class="nv">socket</span><span class="o">=</span>/var/lib/mysql/mysql.sock
</span><span class="line"><span class="nv">mycnf</span><span class="o">=</span>/etc/my.cnf
</span><span class="line">
</span><span class="line"><span class="o">[</span>lvm<span class="o">]</span>
</span><span class="line"><span class="nv">vgname</span><span class="o">=</span>vg0
</span><span class="line"><span class="nv">lvname</span><span class="o">=</span>lv_mysql
</span><span class="line"><span class="nv">backuplv</span><span class="o">=</span>
</span><span class="line"><span class="nv">lvsize</span><span class="o">=</span>50G
</span><span class="line">
</span><span class="line"><span class="o">[</span>fs<span class="o">]</span>
</span><span class="line"><span class="nv">xfs</span><span class="o">=</span>0
</span><span class="line"><span class="nv">mountdir</span><span class="o">=</span>/mnt/mylvmbackup
</span><span class="line"><span class="c">#backupdir=backupuser@backuphost:/data/backup/mysql</span>
</span><span class="line"><span class="nv">backupdir</span><span class="o">=</span>/backup/mysql/
</span><span class="line">
</span><span class="line"><span class="o">[</span>logging<span class="o">]</span>
</span><span class="line"><span class="nv">log_method</span><span class="o">=</span>both
</span><span class="line"><span class="nv">syslog_remotehost</span><span class="o">=</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>创建必要的目录</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># mkdir -p /mnt/mylvmbackup/</span>
</span><span class="line"><span class="c"># mkdir -p /backup/mysql/</span>
</span><span class="line"><span class="c"># chmod 700 /backup/mysql/</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3、手工执行 mylvmbackup</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># mylvmbackup</span>
</span><span class="line">
</span><span class="line"><span class="c"># ll /backup/mysql/</span>
</span><span class="line">-rw-r--r--. 1 root root 571852  6月 24 21:36 backup-20120624_213601_mysql.tar.gz
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="cron--mysql">安排 cron 任务备份重要数据和 Mysql</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># mkdir /backup/fs</span>
</span><span class="line"><span class="c"># chmod 700 /backup/fs</span>
</span><span class="line">
</span><span class="line"><span class="c"># vi /etc/cron.d/backup</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">SHELL</span><span class="o">=</span>/bin/bash
</span><span class="line"><span class="nv">PATH</span><span class="o">=</span>/sbin:/bin:/usr/sbin:/usr/bin
</span><span class="line"><span class="nv">MAILTO</span><span class="o">=</span>root
</span><span class="line"><span class="nv">HOME</span><span class="o">=</span>/
</span><span class="line">
</span><span class="line">0 1 * * * root mylvmbackup
</span><span class="line">0 3 * * * root rsync -av /etc /root /var/lib/tomcat7/webapps /root /home /backup/fs/
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># service crond restart</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/30/translate-puppet-27-cookbook-into-chinese/">Translate Puppet 2.7 Cookbook Into Chinese</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-30T10:52:00+08:00" pubdate data-updated="true">Apr 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>我使用 “AsciiDoc + Github” 的方式翻译了《Puppet 2.7 Cookbook》 的中文版。</p>

<ul>
  <li><a href="https://github.com/sinosmond/puppet-27-cookbook-CN">中文翻译版的源码</a></li>
  <li><a href="http://down.51cto.com/4139732">中文翻译版的 HTML 包</a></li>
</ul>

<p>欢迎各位以 Github 方式提交修正。</p>

<p>中文翻译版仅用于学习目的，请勿用于商业目的。 支持原作者，请购买英文原版。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/14/digital-toolchain-for-book-authors/">Digital Toolchain for Book Authors</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-14T16:39:00+08:00" pubdate data-updated="true">Mar 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>收集了些 AsciiDOC 的文档和工具链，有空慢慢研究。</p>

<ul>
  <li>Documentation Links
    <ul>
      <li><a href="https://gist.github.com/1609255">Digital Toolchain for Book Authors</a></li>
      <li><a href="http://francisshanahan.com/index.php/2010/setup-asciidoc-fop-pygment-on-windows/">How to Setup AsciiDoc, Pygment and FOP on Windows for Beautiful PDF and XHTML Documentation</a></li>
      <li><a href="http://www.stevestreeting.com/2010/03/07/building-a-new-technical-documentation-tool-chain/">Building a new technical documentation tool chain</a></li>
      <li><a href="https://community.jboss.org/message/721016">AsciiDoc is the way forward</a></li>
    </ul>
  </li>
  <li>Tool-chain Links
    <ul>
      <li><strong><a href="https://github.com/schacon/git-scribe">git-scribe</a></strong></li>
      <li><a href="https://github.com/napcs/docbook">Short Attention Span Docbook</a></li>
      <li><a href="https://github.com/FooBarWidget/mizuho">Mizuho documentation formatting tool</a></li>
      <li><a href="https://github.com/fghaas/makedoc">makedoc: A document processing toolchain built on GNU Autotools</a></li>
      <li><a href="https://github.com/akosmasoftware/eBook-Template">Template for Writing an eBook</a></li>
    </ul>
  </li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/12/install-and-deploy-octopress-to-github-on-windows7-from-scratch/">在 Windows7 下从头开始安装部署 Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-12T09:14:00+08:00" pubdate data-updated="true">Mar 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="octopress-">进入 Octopress 的世界</h2>

<h3 id="octopress--1">Octopress 简介</h3>

<ul>
  <li><a href="http://octopress.org/">Octopress</a> 是一款基于 <a href="http://jekyllrb.com/">Jekyll</a> 的静态站点生成系统。
    <ul>
      <li>使用 Markdown 标记语言书写源文件， 通过 Markdown 解析器转换为 HTML 文件</li>
      <li>通过 Octopress 提供的站点模板提供所需的 Web 资产文件 （Javascript、CSS、image 等）</li>
      <li>只包含静态网页，无需数据库支持，对系统要求低且迁移方便  </li>
      <li>以编写程序的方式编制网站，便于实现版本控制</li>
    </ul>
  </li>
  <li><a href="http://octopress.org/">Octopress</a> / <a href="http://jekyllrb.com/">Jekyll</a> 使用简洁的Ruby框架实现。
    <ul>
      <li>Octopress 以 rake 任务的形式实现静态站点页面生成, 操作十分简单</li>
      <li>Octopress 以 rake 任务的形式实现到普通网站和 <a href="http://github.com">Github</a> 的发布 </li>
      <li>Octopress 与 Github 完美结合，你无需学习过多的 git 命令语法，使非专业人士的使用成为可能</li>
    </ul>
  </li>
</ul>

<h3 id="windows-7-">在 Windows 7 下安装必要的软件</h3>

<ul>
  <li>Octopress 在 git 中维护，需要安装 git
    <ul>
      <li>到 <a href="http://code.google.com/p/msysgit/downloads/list">msysgit</a> 查找下载最新版本</li>
      <li>当前的最新版本 Git-1.7.9-preview20120201.exe，下载后直接安装</li>
    </ul>
  </li>
  <li>Octopress/Jekyll 是 ruby 应用程序，需要安装 ruby 
    <ul>
      <li>到 <a href="http://rubyforge.org/frs/?group_id=167">RailsInstaller</a> 查找下载最新版本</li>
      <li>Octopress 要求安装 <a href="http://rubyforge.org/frs/download.php/75127/rubyinstaller-1.9.2-p290.exe">rubyinstaller-1.9.2-p290</a>
        <ul>
          <li>Jekyll 要求安装 <a href="http://rubyforge.org/frs/download.php/72075/rubyinstaller-1.9.1-p430.exe">rubyinstaller-1.9.1-p430</a> </li>
        </ul>
      </li>
      <li>安装后，确保 <code>C:\Ruby192\bin</code> 在 Windows 当前用户的 <code>PATH</code> 环境变量中  </li>
    </ul>
  </li>
  <li>ruby 的模块工具 gem 在生成本地模块时可能需要用到编译环境
    <ul>
      <li>有两种选择 <a href="http://www.mingw.org/">MinGW and MSYS</a> 或 <a href="https://github.com/oneclick/rubyinstaller/wiki/development-kit">RubyInstaller DevKit</a></li>
      <li>本文选择 RubyInstaller 推荐的 <a href="https://github.com/oneclick/rubyinstaller/wiki/development-kit">RubyInstaller DevKit</a></li>
      <li>下载 <a href="https://github.com/downloads/oneclick/rubyinstaller/DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe">RubyInstaller DevKit</a></li>
      <li>安装需执行如下步骤
        <ul>
          <li>将 DevKit 自解压包释放到 C:\DevKit </li>
          <li>在 Windows CMD 窗口中执行  <code>ruby dk.rb init</code> </li>
          <li>在 Windows CMD 窗口中执行  <code>ruby dk.rb install</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>jekyll/Octopress 使用 Python 编写的代码加亮系统 pygments，需要安装 python（可选）
    <ul>
      <li>到 <a href="http://www.activestate.com/activepython">ActiveState</a> 下载 最新的 ActivePython-2.7 版</li>
      <li>执行安装程序</li>
      <li>在 Windows CMD 窗口中执行  <code>easy_install pygments</code></li>
    </ul>
  </li>
</ul>

<h3 id="windows-7--1">软件安装后的 Windows 7 环境说明和配置</h3>

<ul>
  <li>两种命令行环境
    <ul>
      <li>Windows 7 自己的 CMD窗口，用于输入 DOS 类命令</li>
      <li>MINGW/Git Bash 窗口启动了 bash，可以输入 Linux 类命令</li>
    </ul>
  </li>
  <li>环境变量
    <ul>
      <li>在 Windows 的 “高级系统设置” 中设置的 环境变量 可以被 MINGW 窗口<strong>继承</strong>
        <ul>
          <li>设置 <code>LANG</code> 和 <code>LC_ALL</code> 两个环境变量，其值均设置为 <code>zh_CN.UTF-8</code></li>
          <li>在 CMD 窗口中测试： <code>echo %LANG%   %LC_ALL%</code> </li>
          <li>在 MINGW 窗口中测试： <code>echo $LANG   $LC_ALL</code></li>
        </ul>
      </li>
      <li>MINGW/Git Bash 窗口启动了 bash，可以使用 <code>~/.bash_profile</code> 环境设置文件设置环境变量、命令别名等 
        <ul>
          <li><code>$ echo "export LANG LC_ALL" &gt; ~/.bash_profile</code></li>
          <li><code>$ echo "alias ll='ls -l --color=tty'"  &gt;&gt; ~/.bash_profile</code></li>
          <li><code>$ echo "alias ls='ls --color=tty'"     &gt;&gt; ~/.bash_profile</code></li>
          <li><strong>注意：若希望<code>~/.bash_profile</code>中的设置生效，请启动 MINGW/Git Bash 窗口，而不是Windows 的 CMD窗口</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="ruby-">ruby 环境的初始配置</h3>

<ul>
  <li>设置 gem 的更新源
    <ul>
      <li><code>gem sources --remove http://rubygems.org/</code></li>
      <li><code>gem sources -a http://ruby.taobao.org/</code></li>
      <li><code>gem sources -l # 请确保只有 http://ruby.taobao.org 一行输出</code></li>
    </ul>
  </li>
  <li>安装 rdoc 和 bundler
    <ul>
      <li><code>gem install rdoc bundler</code></li>
    </ul>
  </li>
</ul>

<h3 id="octopress">安装 Octopress</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c"># 1. 克隆 Octopress</span>
</span><span class="line"><span class="nv">$ </span>mkdir ~/repos
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ~/repos
</span><span class="line"><span class="nv">$ </span>git clone git://github.com/imathis/octopress.git sinosmond.github.com
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ~/repos/sinomsond.github.com
</span><span class="line"><span class="c"># 2. 修改 Octopress 的 GEM 源</span>
</span><span class="line"><span class="nv">$ </span>vi Gemfile    <span class="c"># 或 notepad Gemfile</span>
</span><span class="line">将行 ： <span class="nb">source</span> <span class="s2">&quot;http://rubygems.org/&quot;</span>
</span><span class="line">改为 ： <span class="nb">source</span> <span class="s2">&quot;http://ruby.taobao.org/&quot;</span>
</span><span class="line"><span class="c"># 3. 安装 Octopress 所需的GEM组件</span>
</span><span class="line"><span class="nv">$ </span>bundle install
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="octopress--2">生成 Octopress 的模版文件</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>rake install
</span><span class="line">rake aborted!
</span><span class="line">You have already activated rake 0.9.2.2, but your Gemfile requires rake 0.9.2.
</span><span class="line">Using bundle <span class="nb">exec </span>may solve this.
</span><span class="line">
</span><span class="line"><span class="o">(</span>See full trace by running task with --trace<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="section">解决方法</h4>

<ol>
  <li><code>$ bundle update; rake install</code></li>
  <li>调整 rake
    <ul>
      <li>在 WINDOWS 的 CMD 窗口里：修改 rake.bat 文件</li>
      <li>在 GIT BASH 里：设置别名</li>
    </ul>
  </li>
</ol>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;alias rake=&#39;bundle exec rake&#39;&quot;</span> &gt;&gt; ~/.bash_profile
</span><span class="line"><span class="nv">$ </span>. ~/.bash_profile
</span><span class="line"><span class="nv">$ </span><span class="nb">alias</span>
</span><span class="line"><span class="nb">alias </span><span class="nv">rake</span><span class="o">=</span><span class="s1">&#39;bundle exec rake&#39;</span>
</span><span class="line"><span class="nv">$ </span>rake install
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="git--github">git 和 github</h3>

<ul>
  <li>学习 git 参考
    <ul>
      <li><a href="http://zh-cn.whygitisbetterthanx.com/">为啥 Git 最棒</a></li>
      <li><a href="http://rogerdudler.github.com/git-guide/index.zh.html">git - 简易指南</a></li>
      <li><a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/">git 魔法</a> – <a href="https://github.com/blynn/gitmagic">git</a></li>
    </ul>
  </li>
  <li>学习 Github 参考
    <ul>
      <li><a href="http://www.yangzhiping.com/tech/github.html">如何高效利用GitHub</a></li>
      <li><a href="http://www.worldhello.net/gotgithub/">GotGitHub</a></li>
      <li><a href="http://help.github.com/">The GitHub Hep</a></li>
    </ul>
  </li>
</ul>

<h3 id="section-1">设置本地仓库和远程仓库的关联</h3>

<ul>
  <li>创建 github 账号和仓库<br />
    <ul>
      <li>下面的操作假定您注册了 <code>&lt;USERNAME&gt;</code> 的账号</li>
      <li>下面的操作假定您创建了 <code>&lt;USERNAME&gt;.github.com</code> 的仓库</li>
      <li>本例使用 sinosmond.github.com，请用 <code>&lt;USERNAME&gt;.github.com</code> 替换之 </li>
    </ul>
  </li>
  <li>在本地版本库中设置远程版本库的别名<br />
    <ul>
      <li><code>$ git remote add myblog git@github.com:sinosmond/sinosmond.github.com.git</code></li>
    </ul>
  </li>
</ul>

<h2 id="octopress-1">配置和使用 Octopress</h2>

<h3 id="octopress--3">Octopress 的基本配置</h3>

<ul>
  <li>编辑 _config.yml 文件 ，根据您自己的需要修改其值, <a href="http://octopress.org/docs/configuring/">参考</a></li>
  <li><strong>若文件中包括中文，则存成 UTF-8 编码格式</strong> </li>
</ul>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="c1"># ----------------------- #</span>
</span><span class="line"><span class="c1">#      Main Configs       #</span>
</span><span class="line"><span class="c1"># ----------------------- #</span>
</span><span class="line"><span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span>                <span class="c1"># For rewriting urls for RSS, etc</span>
</span><span class="line"><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span>              <span class="c1"># Used in the header and title tags</span>
</span><span class="line"><span class="l-Scalar-Plain">subtitle</span><span class="p-Indicator">:</span>           <span class="c1"># A description used in the header</span>
</span><span class="line"><span class="l-Scalar-Plain">author</span><span class="p-Indicator">:</span>             <span class="c1"># Your name, for RSS, Copyright, Metadata</span>
</span><span class="line"><span class="l-Scalar-Plain">simple_search</span><span class="p-Indicator">:</span>      <span class="c1"># Search engine for simple site search</span>
</span><span class="line"><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span>        <span class="c1"># A default meta description for your site</span>
</span><span class="line"><span class="l-Scalar-Plain">subscribe_rss</span><span class="p-Indicator">:</span>      <span class="c1"># Url for your blog&#39;s feed, defauts to /atom.xml</span>
</span><span class="line"><span class="l-Scalar-Plain">subscribe_email</span><span class="p-Indicator">:</span>    <span class="c1"># Url to subscribe by email (service required)</span>
</span><span class="line"><span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span>              <span class="c1"># Email address for the RSS feed if you want it.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-2">编辑新页面</h3>

<ul>
  <li>生成 BLOG/静态 页面<br />
    <ul>
      <li><code>rake new_post["article name"]</code> : 生成指定的 Blog 初始页面</li>
      <li><code>rake new_page["page name"]</code> : 生成指定的静态初始页面</li>
    </ul>
  </li>
  <li>使用你惯用的编辑器修改新生成的文件
    <ul>
      <li>使用 YAML 语法设置本页面属性，用 Markdown 语法书写文章内容</li>
      <li><strong>若文件中包括中文，则存成 UTF-8 编码格式</strong> </li>
      <li><a href="http://wowubuntu.com/markdown/">Markdown 语法说明</a></li>
      <li><a href="http://daringfireball.net/projects/markdown/dingus">Markdown: Dingus</a> 是一个在线转换工具</li>
      <li>若使用 kramdown 解析器，参考 <a href="http://kramdown.rubyforge.org/syntax.html">kramdown 语法</a> </li>
      <li><a href="http://johnmacfarlane.net/pandoc/try">Markdown 和多种标记语言的在线转换</a></li>
      <li><a href="http://babelmark.bobtfish.net/">Markdown 多种实现的在线比较</a></li>
    </ul>
  </li>
</ul>

<h3 id="github">首次提交到 Github</h3>

<ol>
  <li><code>rake setup_github_pages</code> ： 配置 octopress 与 github 的连接</li>
  <li><code>rake generate</code> ： 生成静态文件</li>
  <li><code>rake preview</code> ： 在本机4000端口生成访问内容</li>
  <li><code>rake deploy</code> ：  发布文件到 github</li>
</ol>

<h3 id="rake--blog">使用 rake 任务管理 BLOG</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>rake -T
</span><span class="line">rake clean                     <span class="c"># Clean out caches: .pygments-cache, .gist-c...</span>
</span><span class="line">rake copydot<span class="o">[</span><span class="nb">source</span>,dest<span class="o">]</span>      <span class="c"># copy dot files for deployment</span>
</span><span class="line">rake deploy                    <span class="c"># Default deploy task</span>
</span><span class="line">rake gen_deploy                <span class="c"># Generate website and deploy</span>
</span><span class="line">rake generate                  <span class="c"># Generate jekyll site</span>
</span><span class="line">rake install<span class="o">[</span>theme<span class="o">]</span>            <span class="c"># Initial setup for Octopress: copies the de...</span>
</span><span class="line">rake integrate                 <span class="c"># Move all stashed posts back into the posts...</span>
</span><span class="line">rake isolate<span class="o">[</span>filename<span class="o">]</span>         <span class="c"># Move all other posts than the one currentl...</span>
</span><span class="line">rake list                      <span class="c"># list tasks</span>
</span><span class="line">rake new_page<span class="o">[</span>filename<span class="o">]</span>        <span class="c"># Create a new page in source/(filename)/ind...</span>
</span><span class="line">rake new_post<span class="o">[</span>title<span class="o">]</span>           <span class="c"># Begin a new post in source/_posts</span>
</span><span class="line">rake preview                   <span class="c"># preview the site in a web browser</span>
</span><span class="line">rake push                      <span class="c"># deploy public directory to github pages</span>
</span><span class="line">rake rsync                     <span class="c"># Deploy website via rsync</span>
</span><span class="line">rake set_root_dir<span class="o">[</span>dir<span class="o">]</span>         <span class="c"># Update configurations to support publishin...</span>
</span><span class="line">rake setup_github_pages<span class="o">[</span>repo<span class="o">]</span>  <span class="c"># Set up _deploy folder and deploy branch fo...</span>
</span><span class="line">rake update_source<span class="o">[</span>theme<span class="o">]</span>      <span class="c"># Move source to source.old, install source ...</span>
</span><span class="line">rake update_style<span class="o">[</span>theme<span class="o">]</span>       <span class="c"># Move sass to sass.old, install sass theme ...</span>
</span><span class="line">rake watch                     <span class="c"># Watch the site and regenerate when it changes</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="octopress-2">进一步配置 Octopress</h3>

<ul>
  <li>配置 社会化网络 应用</li>
  <li>选择您中意的网站注册，获得用户名或网络代码，将代码存入 <code>source/_includes/{post,custom}</code> 目录   </li>
</ul>

<table>
  <tbody>
    <tr>
      <td>类型</td>
      <td>国外服务</td>
      <td>国内服务</td>
    </tr>
    <tr>
      <td>Feed烧制</td>
      <td><a href="http://feedburner.google.com">FeedBurner</a></td>
      <td><a href="http://www.feedsky.com/">FeedSky</a></td>
    </tr>
    <tr>
      <td>分享到</td>
      <td><a href="http://www.addthis.com/">AddThis</a></td>
      <td><a href="http://www.jiathis.com/">JiaThis</a></td>
    </tr>
    <tr>
      <td>微博</td>
      <td>Twitter</td>
      <td>weibo.com</td>
    </tr>
    <tr>
      <td>网络书签</td>
      <td><a href="http://delicious.com/">Delicious</a>, <a href="http://www.google.com/bookmarks">Google Bookmarks</a></td>
      <td><a href="http://shuqian.qq.com/">QQ书签</a>, <a href="http://cang.baidu.com/">百度搜藏</a></td>
    </tr>
    <tr>
      <td>网络图床</td>
      <td><a href="http://www.flickr.com/">Flickr</a></td>
      <td><a href="http://www.yupoo.com/">yupoo</a> , <a href="http://www.poco.cn/">POCO</a></td>
    </tr>
    <tr>
      <td>网络评论</td>
      <td><a href="http://disqus.com/">Disqus</a></td>
      <td><a href="http://uyan.cc/">友言</a></td>
    </tr>
  </tbody>
</table>

<h3 id="blog-jiathis">配置举例1：为每一篇BLOG结尾添加 “JiaThis”</h3>

<p>1、在 <code>_config.yml</code> 尾部添加如下行</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="c1"># JiaThis</span>
</span><span class="line"><span class="l-Scalar-Plain">jiathis</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>2、在 <code>source/_includes/post/sharing.html</code> 尾部的<code>&lt;/div&gt;</code>之前添加如下行</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line">  <span class="p-Indicator">{</span><span class="err">%</span> <span class="nv">if site.jiathis %</span><span class="p-Indicator">}</span>
</span><span class="line">    <span class="p-Indicator">{</span><span class="err">%</span> <span class="nv">include post/jiathis.html %</span><span class="p-Indicator">}</span>
</span><span class="line">  <span class="p-Indicator">{</span><span class="err">%</span> <span class="nv">endif %</span><span class="p-Indicator">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3、创建 <code>source/_includes/post/jiathis.html </code> 文件，将从<a href="http://www.jiathis.com/">JiaThis</a>获得的代码放入其中</p>

<h3 id="section-3">配置举例2： 配置侧栏</h3>

<ul>
  <li>在 <code>_config.yml</code> 中指定显示内容和显示顺序</li>
  <li>显示内容
    <ul>
      <li>系统默认的显示边栏的内容基于 source/_includes 目录保存为 <code>asides/*.html</code></li>
      <li>用户自定义的边栏内容基于 source/_includes 目录保存为 <code>custom/asides/*.html</code></li>
    </ul>
  </li>
  <li>显示顺序
    <ul>
      <li><code>blog_index_asides</code> 控制BLOG首页的边栏显示</li>
      <li><code>post_asides</code> 控制每一个单独的BLOG页面显示时的边栏（对应 <code>rake new_post[]</code>）</li>
      <li><code>page_asides</code> 控制静态页面显示时的边栏（对应 <code>rake new_page[]</code>）</li>
    </ul>
  </li>
</ul>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="l-Scalar-Plain">blog_index_asides</span><span class="p-Indicator">:</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/feeds.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/recent_posts.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/recent_comments.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/opers.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/github.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/twitter.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/delicious.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/pinboard.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/googleplus.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/weibo.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/copyleft.html</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">post_asides</span><span class="p-Indicator">:</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/recent_posts.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/recent_comments.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/opers.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/copyleft.html</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">page_asides</span><span class="p-Indicator">:</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">asides/recent_posts.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/recent_comments.html</span>
</span><span class="line"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">custom/asides/copyleft.html</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-4">更新管理源码的仓库分支</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">git add .
</span><span class="line">git commit -m <span class="s2">&quot;add some changes&quot;</span>
</span><span class="line">git push myblog <span class="nb">source</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-5">参考链接</h3>

<ul>
  <li>http://chen.yanping.me/cn/blog/2011/12/26/octopress-on-windows/</li>
  <li>http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/</li>
  <li>http://www.yangzhiping.com/tech/octopress.html</li>
  <li>http://blog.xupeng.me/2011/12/14/migrate-to-octopress/</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/10/past-and-present/">过去和现在</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-10T11:47:00+08:00" pubdate data-updated="true">Mar 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">过去的选择</h2>

<ul>
  <li>喜欢 <a href="http://dotclear.org/">Dotclear</a> 胜过 <a href="http://wordpress.org/">WordPress</a></li>
  <li>喜欢结构化文档的理念
    <ul>
      <li>开源文档世界中的 <a href="http://docbook.org/">DocBook</a> 虽好，但 XML 书写繁琐</li>
      <li>轻量级的文本标记语言和各种 Wiki 标记语言虽然简单，但语义表达能力弱，但写 BLOG 等一般的短文章也足够用了
        <ul>
          <li>轻量级的文本标记语言： <a href="http://daringfireball.net/projects/markdown/">markdown</a>、 <a href="http://docutils.sourceforge.net/rst.html">reST</a>、  <a href="http://txt2tags.sf.net">txt2tags</a> …
            <ul>
              <li><a href="http://markdown.infogami.com/">Markdown Wiki</a></li>
              <li><a href="http://johnmacfarlane.net/pandoc/try">Markdown 和多种标记语言的在线转换</a></li>
              <li><a href="http://babelmark.bobtfish.net/">Markdown 多种实现的在线比较</a></li>
            </ul>
          </li>
          <li>各种 Wiki 标记语言： Creole、 dokuwiki、 moinmoin、 Mediawiki …
            <ul>
              <li><a href="http://www.wikimatrix.org/">各种 Wiki 系统（包括标记语言）的比较</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="http://www.methods.co.nz/asciidoc/">AsciiDoc</a>：折中的选则，架起了文本标记语言和 DocBook 的桥梁，基本实现了 DocBook 的语义表达</li>
    </ul>
  </li>
  <li>逐渐更喜欢不带关系数据库的个人站点应用，因为备份简单（<code>rsync</code>）
    <ul>
      <li>最初使用 <a href="http://txt2tags.sf.net">txt2tags</a> – 仅实现了txt2tags语法到html的转换，缺乏版本控制</li>
      <li>后转向 <a href="http://dokuwiki.org">Dokuwiki</a> – dokuwiki语法+内置的版本控制</li>
      <li>曾经想切换到 <a href="http://ikiwiki.info/">ikiwiki</a> – MarkDown语法+git版本控制</li>
    </ul>
  </li>
</ul>

<h2 id="section-1">痛苦的过去</h2>

<ul>
  <li>曾经注册过自己的域名 </li>
  <li>曾经在国内和国外购买过虚拟主机空间</li>
</ul>

<blockquote>
  <p><strong>无奈皆因家中琐事繁多，无暇打理，导致域名被抢注、主机空间因未续费而被停用</strong></p>
</blockquote>

<h2 id="section-2">如今的选择</h2>

<ul>
  <li>使用 <a href="http://github.com">github</a> 免费的二级域名，免去因忘记域名续费而被抢注的困扰</li>
  <li>
    <p>使用 <a href="http://github.com">github</a> 提供的 300M 免费空间，对于一般情况也足够用了，免去因忘记空间续费而被停用的困扰</p>
  </li>
  <li>使用 git 的版本控制替代 wiki 内置的版本控制，在 github 上 <strong>BLOG 即 REPO</strong></li>
  <li>使用 markdown 语法替代以前的 DokuWiki 语法书写文档</li>
  <li>在 github 上创建个人站点的工具主要是 <a href="http://octopress.org/">Octopress</a> 和 <a href="http://jekyllbootstrap.com/">Jekyll-Bootstrap</a>，因后者似乎还不太成熟遂选择前者</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/10/hello-octopress/">Hello Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-10T08:36:00+08:00" pubdate data-updated="true">Mar 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>my first post to octopresss.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>FEED</h1>
<!-- Feedsky FEED发布代码开始 -->
<!-- FEED自动发现标记开始 -->
<div style="text-align: center;">
<link title="RSS 2.0" type="application/rss+xml" href="http://feed.feedsky.com/SinosmondsBlog" rel="alternate" />
<!-- FEED自动发现标记结束 -->
<a target="_blank" href="http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_sub_c1s12.gif" alt="feedsky" vspace="2"  style="margin-bottom:3px" ></a><br />
<a target="_blank" href="http://www.zhuaxia.com/add_channel.php?url=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_zhuaxia.gif" alt="&#25235;&#34430;" vspace="2" style="margin-bottom:3px" ></a>
<a target="_blank" href="http://fusion.google.com/add?feedurl=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_google.gif" alt="google reader" vspace="2" style="margin-bottom:3px" ></a><br />
<a target="_blank" href="http://add.my.yahoo.com/rss?url=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_yahoo.gif" alt="my yahoo" vspace="2" style="margin-bottom:3px" ></a>
<a target="_blank" href="http://www.xianguo.com/subscribe.php?url=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_xianguo.gif" alt="&#40092;&#26524;" vspace="2" style="margin-bottom:3px" ></a><br />
<a target="_blank" href="http://inezha.com/add?url=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_nazha.gif" alt="&#21738;&#21522;" vspace="2" style="margin-bottom:3px" ></a>
<a target="_blank" href="http://mail.qq.com/cgi-bin/feed?u=http://feed.feedsky.com/SinosmondsBlog"><img border="0" src="http://img.feedsky.com/images/icon_subshot01_qq.gif" alt="QQ&#37038;&#31665;" vspace="2" style="margin-bottom:3px" ></a><br />
<!-- Feedsky FEED发布代码结束 -->
</div>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/09/installing-the-collaboration-system/">在 CentOS 6.2 上安装协作系统</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/24/centos6-dot-2-plus-jdk6-plus-tomcat7-plus-nginx1-dot-2-plus-mysql5-dot-x/">CentOS6.2 + JDK6 + Tomcat7 + Nginx1.2 + MySQL5.X</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/04/30/translate-puppet-27-cookbook-into-chinese/">Translate Puppet 2.7 Cookbook into Chinese</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/14/digital-toolchain-for-book-authors/">Digital Toolchain for Book Authors</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/12/install-and-deploy-octopress-to-github-on-windows7-from-scratch/">在 Windows7 下从头开始安装部署 Octopress</a>
      </li>
    
  </ul>
</section>

<section>
<H1>Recent Comments</H1>
<script type="text/javascript" src="http://sinosmond.disqus.com/combination_widget.js?num_items=5&hide_mods=0&color=blue&default_tab=people&excerpt_length=200"></script><a href="http://disqus.com/">Powered by Disqus</a>
</section><section>
  <h1>Octopress Blogroll</h1>
  <ul  style="padding-left:0">
	<li><a target="_blank" href="http://www.worldhello.net/">蒋鑫</a></li>
	<li><a target="_blank" href="http://larrycai.github.com/">Larry Cai</a></li>
	<li><a target="_blank" href="http://blog.xupeng.me/">XuPeng</a></li>
	<li><a target="_blank" href="http://adam8157.info/">Adam</a></li>
	<li><a target="_blank" href="http://roylez.heroku.com/">Roylez</a></li>
	<li><a target="_blank" href="http://blog.xdite.net/">xdite</a></li>
	<li><a target="_blank" href="http://blog.devtang.com/">唐巧</a></li>
	<li><a target="_blank" href="http://yihui.name/cn">谢益辉</a></li>
	<li><a target="_blank" href="http://chen.yanping.me/cn">雁起平沙</a></li>
	<li><a target="_blank" href="http://www.yangzhiping.com/">阳志平</a></li>
	<li><a target="_blank" href="http://tonytonyjan.heroku.com/">tonytonyjan</a></li>
  </ul>
</section>






<section>
<iframe width="100%" height="108" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=108&fansRow=1&ptype=1&speed=300&skin=2&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1219855341&verifier=73cc3461&dpc=1"></iframe>
</section><section>
  <h1>Copyright</h1>
  <p align="center"> <a target="_ blank" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/"><img src="http://i.creativecommons.org/l/by-nc-sa/2.5/cn/88x31.png" alt="Creative Commons License"/></a></p>
  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/cn/">CC2.5: 知识共享署名-非商业性使用</a>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - sinosmond -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sinosmond';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
